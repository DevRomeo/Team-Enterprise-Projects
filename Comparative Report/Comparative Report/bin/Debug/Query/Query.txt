SELECT a.accountname AS partnername ,a.accountid AS partnercode ,

SUM(COALESCE(IF(s.yr=@cyear,txncount,0),0)) AS txncurrent ,

SUM(COALESCE(IF(s.yr=@pvyear ,txncount,0),0)) AS txnprev ,
IF((COALESCE(s.int_type,(SELECT DISTINCT(i.integrationtype) FROM kpadminpartners.accountintegration i WHERE i.accountid=a.accountid LIMIT 1))) =4,2,
(COALESCE(s.int_type,(SELECT DISTINCT(i.integrationtype) FROM kpadminpartners.accountintegration i WHERE i.accountid=a.accountid LIMIT 1))) 
)AS intType,
	(SUM(COALESCE(IF(s.yr=@cyear,txncount,0),0)) - SUM(COALESCE(IF(s.yr=@pvyear ,txncount,0),0))) AS var,  
	(
		CASE 
		WHEN SUM(COALESCE(IF(s.yr=@pvyear ,txncount,0),0))=0 THEN SUM(COALESCE(IF(s.yr=@cyear,txncount,0),0)) 
		ELSE (SUM(COALESCE(IF(s.yr=@cyear,txncount,0),0)) - SUM(COALESCE(IF(s.yr=@pvyear ,txncount,0),0)))/SUM(COALESCE(IF(s.yr=@pvyear ,txncount,0),0))*100 END
	)AS per 
FROM  kpadminpartners.accountlist a  
LEFT JOIN  kpUploadArchive.partners_summary s ON a.accountid=s.partnercode AND s.currency=@curr AND s.mo=@mont
WHERE a.isactive=1 AND      xxaccounttypexx   GROUP BY a.accountid  xxintypexx 
ORDER BY intType,per DESC
