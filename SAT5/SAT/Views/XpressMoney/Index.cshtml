@model IEnumerable<SAT.Models.UploadedFilesModel>


<div class="panel">




   
     <div class="panel-heading clearfix">
         <button type="button" class="btn btn-default btn-lg pull-right upload-trigger " data-toggle="modal" data-target="#main-modal">
             <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>Upload
         </button>
     </div>
        
    
    <div class="container">
        <table class="table table-striped">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.fname)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.ftotal)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.SYSCREATED)
                </th>
         
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.fname)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ftotal)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.SYSCREATED)
                    </td>
              

                </tr>
            }

        </table>
    </div>


</div>
@section modalHeader{
    XpressMoney Upload
}
@section modalContent{
    <h4>Select file from your computer</h4>

    @using (Ajax.BeginForm("Upload", "XpressMoney", new AjaxOptions() { HttpMethod = "POST" }, new { enctype = "multipart/form-data", id = "form" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
        <div class="form-inline">
            <div class="form-group">
                <input type="file" id="file" name="file" accept=".xls">
            </div><br/>
            <div class="form-group">
                Sheet Name: <select id="SheetNo" name="sheetNo"></select>
            </div>
            <button type="submit" class="btn btn-sm btn-primary" id="js-upload-submit">Upload file</button>
        </div>
    }
}
@section scripts{

    <script type="text/javascript">
    $(document).ready(function () {
        $('#form').on('submit', function (e) {

            e.preventDefault();
            $('#load-modal').modal('show');
            $.ajax({
                url: '@Url.Action("Upload", "XpressMoney")',
                    type:'POST',
                    cache: false,
                    processData: false,
                    contentType: false,
                    data: new FormData($('#form')[0]),
                    success: function (response) {
                        alert(response.responseMessage);
                        if (response.responseCode == 1)
                        {
                            window.location.replace('@Url.Action("Index", "XpressMoney")');
                        }
                        $('#load-modal').modal('hide');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                    $('#load-modal').modal('hide');
                }

            });




        });
        $("#file").on('change', function () {
            var val = $(this).val();

            if (val != '') {
                //e.preventDefault();
                var temp = new FormData($('#form')[0]);
                var dropdownlist = $("#SheetNo");
                dropdownlist.empty();
                $.ajax({
                    type: "POST",
                    url: "/XpressMoney/getSheets",
                    cache: false,
                    processData: false,
                    contentType: false,
                    data: temp,
                    success: function (response) {
                        // $("#filename").val(response.filename);
                        populateDropdown(response.responseData, "SheetNo");


                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);

                    }
                });

            }
            else {

            }
        });


    });
    function beginUpload(e) {
        e.preventDefault();
    };
    function uploadComplete(response) {
        alert(response.responseMessage);
    };
    function uploadFailed(response) {
        alert(response.responseMessage);
    };
    function populateDropdown(Datasource, TargetID) {
        var element = document.getElementById(TargetID);
        for (item in Datasource) {


            $(document.createElement('option'))
              .attr('value', Datasource[item])
              .text(Datasource[item])
              .appendTo(element);

        };
    };
    </script>
}








